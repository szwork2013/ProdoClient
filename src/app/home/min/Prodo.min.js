angular.module("prodo.ProductApp").controller("DragImageController",["$scope","$rootScope","$log",function(a,b,c){function d(a){if(g.filereader===!0&&h[a.type]===!0){var c=new FileReader;c.onload=function(a){var c=new Image;c.src=a.target.result,b.comment_image_l=[{image:c.src}],c.width=250,f.appendChild(c)},c.readAsDataURL(a)}else f.innerHTML+=" Uploaded "+a.name+" "+(a.size?(a.size/1024|0)+"K":"");var d=new FileReader;d.onload=function(c){var d=c.target.result;b.file_data={filetype:a.type,filename:a.name,filebuffer:d}},d.readAsBinaryString(a)}function e(a){for(var b=g.formdata?new FormData:null,e=0;e<a.length;e++)g.formdata&&b.append("file",a[e]),d(a[e]),c.debug(a[e].name)}{var f=document.getElementById("holder"),g={filereader:"undefined"!=typeof FileReader,dnd:"draggable"in document.createElement("span"),formdata:!!window.FormData},h=({filereader:document.getElementById("filereader"),formdata:document.getElementById("formdata"),progress:document.getElementById("progress")},{"image/png":!0,"image/jpeg":!0,"image/gif":!0});document.getElementById("upload")}g.dnd&&(f.ondragover=function(){return this.className="hover",!1},f.ondragend=function(){return this.className="",!1},f.ondrop=function(a){this.className="",a.preventDefault(),e(a.dataTransfer.files)})}]),angular.module("prodo.ProductApp").controller("ProductController",["$scope","$log","$rootScope","ProductService","UserSessionService","$http",function(a,b,c,d,e,f){function g(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function h(){return g()+"-"+g()+"-"+Date.now().toString()}a.productComments={comments:[{}]},a.newProductComment=[],a.productCommentResponsearray=[],a.mytags,a.count=0,a.commenttextField={userComment:""},a.pretags=["addition","aggregate","all","bad news","budget","cost","damage","entirety","expense","extent","list","lot","net","outlay","output","price tag","product","quantum","score","set-back","sum","tab","tidy sum","whole","article","asset","belonging","chattel","goods","line","material","object","produce","property","specialty","stock","thing","ware","good"],a.product={product:[{}]},a.newProduct={product:[{}]},a.type="product",a.product_prodle,a.pImages_l={product_images:[{}]},a.userIDFromSession,a.userFullnameFromSession,a.grpnameFromSession,a.orgnameFromSession,a.orgidFromSession,a.socket,a.showErrorIfCommentNotAdded=function(){var a=document.getElementById("responseComment");a.style.display="inline",a.innerHTML="Error adding comment please try again.."},a.showRetryIconIfCommentNotAdded=function(){var a=document.getElementById("retryIcon");a.style.display="inline"},a.getUserDetails=function(){c.usersession.currentUser.org?(a.grpnameFromSession=c.usersession.currentUser.org.grpname,a.orgidFromSession=c.usersession.currentUser.org.orgid,a.orgnameFromSession=c.usersession.currentUser.org.orgname):(a.grpnameFromSession="",a.orgnameFromSession="",a.orgidFromSession=""),a.userIDFromSession=c.usersession.currentUser.userid,a.userFullnameFromSession=c.usersession.currentUser.username},a.getUserDetails(),localStorage.sid=c.usersession.currentUser.sessionid,a.socket=io.connect("http://ec2-54-254-210-45.ap-southeast-1.compute.amazonaws.com:8000/prodoapp",{query:"session_id="+localStorage.sid}),a.socket.removeAllListeners("addcommentResponse"),a.socket.on("addcommentResponse",function(c,d){c?(b.debug(c.error.message),a.showErrorIfCommentNotAdded(),a.showRetryIconIfCommentNotAdded()):d&&(a.ifErrorAddingComment=!1,b.debug("addcommentResponse success"+d.success.product_comment))}),a.socket.removeAllListeners("productcommentResponse"),a.socket.on("productcommentResponse",function(c,d){if(c)b.debug(c.error.message);else if(d){b.debug("productcomment  Response success"+d.success.product_comment),a.productCommentResponsearray.push(d.success.product_comment),a.count=a.productCommentResponsearray.length,b.debug(a.count);var e=document.getElementById("responseComment");e.style.display="inline",e.innerHTML=a.count+" new comments"}}),a.addProductComment=function(){if(b.debug(c.file_data),b.debug(c.comment_image_l),void 0==c.file_data?(a.newProductComment={product_comment:{user:{userid:a.userIDFromSession,fullname:a.userFullnameFromSession,orgname:a.orgnameFromSession,grpname:a.grpnameFromSession},commentid:h(),type:a.type,datecreated:Date.now(),commenttext:a.commenttextField.userComment}},a.newProductComment_image={product_comment:{user:{userid:a.userIDFromSession,fullname:a.userFullnameFromSession,orgname:a.orgnameFromSession,grpname:a.grpnameFromSession},commentid:h(),type:a.type,datecreated:Date.now(),commenttext:a.commenttextField.userComment}}):(a.newProductComment={product_comment:{user:{userid:a.userIDFromSession,fullname:a.userFullnameFromSession,orgname:a.orgnameFromSession,grpname:a.grpnameFromSession},commentid:h(),type:a.type,datecreated:Date.now(),commenttext:a.commenttextField.userComment,comment_image:c.file_data}},a.newProductComment_image={product_comment:{user:{userid:a.userIDFromSession,fullname:a.userFullnameFromSession,orgname:a.orgnameFromSession,grpname:a.grpnameFromSession},commentid:h(),type:a.type,datecreated:Date.now(),commenttext:a.commenttextField.userComment,comment_image:c.comment_image_l}}),b.debug(a.newProductComment),""!==a.commenttextField.userComment){a.socket.emit("addComment","xkW3VkEId",a.newProductComment.product_comment),a.productComments.unshift(a.newProductComment_image.product_comment),a.commenttextField.userComment="";var d=document.getElementById("holder");d.removeChild(d.childNodes[d.childNodes.length-1])}},a.getProduct=function(){d.getProduct({orgid:a.orgidFromSession,prodle:"xkW3VkEId"},function(c){void 0==c.success?a.showAlert("alert-danger"," Product not available ..."):(b.debug(c.success.product),a.product=c.success.product,a.product_prodle=c.success.product.prodle,a.productComments=c.success.product.product_comments,a.pImages_l=c.success.product.product_images)},function(c){b.debug(c),a.showAlert("alert-danger","Server Error:"+c.status)})},a.getProduct(),a.getLatestComments=function(){a.reversecomments_l=a.productCommentResponsearray.reverse(),a.productComments=a.reversecomments_l.concat(a.productComments);var b=document.getElementById("responseComment");b.style.display="none",b.innerHTML="",a.productCommentResponsearray.length=0,a.reversecomments_l.length=0,a.count=0},a.handleSaveProductResponse=function(a){a.success?alert(a.success.message):"AV001"==a.error.code?(b.debug(a.error.code+" "+a.error.message),alert(a.error.message)):"AP001"==a.error.code?(b.debug(a.error.code+" "+a.error.message),alert(a.error.message)):(b.debug(a.error.message),alert(a.error.message))},a.addProduct=function(){a.newProduct={product:{display_name:a.display_name,serial_no:a.product.serial_no,model_no:a.product.model_no,name:a.product.name,description:a.product.description}},d.saveProduct({orgid:a.orgidFromSession},a.newProduct,function(c){b.debug(c),a.handleSaveProductResponse(c)},function(a){b.debug(a)})},a.deleteProduct=function(){c.usersession.currentUser.isAdmin?d.deleteProduct({orgid:a.orgidFromSession,prodle:a.product_prodle}):alert("You dont have rights to delete this product...")},a.hideIfNotUser=function(b){return b&&b!==a.userFullnameFromSession?{display:"none"}:void 0},a.hideIfNoOrg=function(a){return""==a||" "==a||void 0==a||null==a?{display:"none"}:void 0},a.hideIfNogrp=function(a){return""==a||" "==a||void 0==a||null==a?{display:"none"}:void 0},a.hideIfNotImage=function(a){return""==a||" "==a||void 0==a||null==a?{display:"none"}:void 0},a.masterChange=function(){$(".imgToggles").is(":checked")?$(".imgToggles").prop("checked",!1):$(".imgToggles").prop("checked",!0)},a.chckedIndexs=[],a.checkedIndex=function(c){-1===a.chckedIndexs.indexOf(c)?a.chckedIndexs.push(c):a.chckedIndexs.splice(a.chckedIndexs.indexOf(c),1),b.debug(a.chckedIndexs)},a.deleteProductImages=function(){a.imgIds=[{}],a.ids,$(":checkbox:checked").each(function(b){a.imgIds[b]=$(this).val(),a.ids=$(this).val()}),angular.forEach(a.chckedIndexs,function(c){b.debug("value= "+c);a.pImages_l.indexOf(c);a.pImages_l.splice(a.pImages_l.indexOf(c),1)}),a.chckedIndexs=[],a.temp={prodleimageids:a.imgIds},f({method:"DELETE",url:"http://localhost/api/image/product/"+a.orgidFromSession+"/"+a.product_prodle+"?prodleimageids="+a.imgIds}).success(function(a){b.debug(a)}).error(function(a,c){b.debug(c)})},a.checkAdmin=function(){if(c.usersession.currentUser.org.isAdmin){var a=document.getElementById("prodo.productAdmin");a.style.display="inline"}}}]),angular.module("prodo.ProductApp").factory("ProductService",["$resource",function(a){return a("/api/product/:orgid/:prodle",{},{getProduct:{method:"GET",params:{orgid:"id",prodle:"id"}},updateProduct:{method:"PUT",params:{orgid:"id",prodle:"id"},isArray:!1},deleteProduct:{method:"DELETE",params:{orgid:"id",prodle:"id"}},saveProduct:{method:"POST",params:{orgid:"id"}}})}]).factory("CommentService",["$resource",function(a){return a("/api/comment/:commentid",{},{deleteComment:{method:"DELETE",params:{commentid:"id"}}})}]),angular.module("prodo.WarrantyApp").controller("WarrantyController",["$scope","$log","WarrantyService","WarrantySaveService",function(a,b,c){a.warrantyComments={comments:[{}]},a.mytags,a.warranty,a.userIDFromSession,a.userFullnameFromSession,a.socket,a.newWarranty={product:[{}]},a.commenttextField={userComment:""},a.type="warranty",a.pretags=["addition","aggregate","all","bad news","budget","cost","damage","entirety","expense","extent","list","lot","net","outlay","output","price tag","product","quantum","score","set-back","sum","tab","tidy sum","whole","article","asset","belonging","chattel","goods","line","material","object","produce","property","specialty","stock","thing","ware","good"],a.showErrorIfCommentNotAdded=function(){var a=document.getElementById("responseComment");a.style.display="inline",a.innerHTML="Error adding comment please try again.."},a.showRetryIconIfCommentNotAdded=function(){var a=document.getElementById("retryIcon");a.style.display="inline"},a.socket=io.connect("http://ec2-54-254-210-45.ap-southeast-1.compute.amazonaws.com:8000",{query:"session_id="+localStorage.sid}),a.socket.on("addcommentResponse",function(c,d){c?(b.debug(c.error.message),a.showErrorIfCommentNotAdded(),a.showRetryIconIfCommentNotAdded()):d&&(a.ifErrorAddingComment=!1,b.debug("addcommentResponse success"+d.success.product_comment))}),a.socket.on("productcommentResponse",function(c,d){if(c)b.debug(c.error.message);else if(d){b.debug("productcomment  Response success"+d.success.product_comment),a.productCommentResponsearray.push(d.success.product_comment);var e=a.productCommentResponsearray.length;b.debug(e);var f=document.getElementById("responseComment");f.style.display="inline",f.innerHTML=e+" new comments"}}),a.handleSaveWarrantyResponse=function(a){a.success?alert(a.success.message):"AV001"==a.error.code?(b.debug(a.error.code+" "+a.error.message),alert(a.error.message)):"AP001"==a.error.code?(b.debug(a.error.code+" "+a.error.message),alert(a.error.message)):(b.debug(a.error.message),alert(a.error.message))},a.productWarranty={warranty:[{warrantyno:"1",modelno:"1123",serialno:"123123",dateofpurchase:"12 Nov 13",invoiceno:"2"},{warrantyno:"2",modelno:"2343",serialno:"12345345323",dateofpurchase:"11 Nov 13",invoiceno:"4"},{warrantyno:"3",modelno:"654645",serialno:"7676767",dateofpurchase:"12 Oct 13",invoiceno:"5"}]},b.debug("data= "+a.productWarranty.warranty),a.getWarrantyFunction=function(){c.getWarranty({prodle:"xk7i99lj8"},function(c){b.debug(c.success.warranty.warranty_comments),a.warranty=c.success.warranty,a.warrantyComments=c.success.warranty.warranty_comments},function(a){b.debug(a)})},a.getLatestComments=function(){a.getWarrantyFunction();var b=document.getElementById("responseComment");b.style.display="none",b.innerHTML=""},a.warrantyComments={comments:[{commenttext:"good warranty service",status:"active",datecreated:"2013-12-16T07:53:52.725Z",tags:[],user:{userid:"uxkfzVj7or",fullname:"Bhagyashri"}},{commenttext:"hiii",status:"active",datecreated:"2013-12-16T07:50:47.763Z",tags:[],user:{userid:"uxkfzVj7or",fullname:"Bhagyashri"}}]},a.deleteWarranty=function(b){var c=a.productWarranty.warranty.indexOf(b);-1!=c&&a.productWarranty.warranty.splice(c,1)},a.hideIfNotUser=function(b){return b&&b!==a.userFullnameFromSession?{display:"none"}:void 0},a.addWarranty=function(){a.newWarranty={warranty:{warrantyno:"4",modelno:a.warranty.modelno,serialno:a.warranty.serialno,dateofpurchase:a.warranty.dateofpurchase,invoiceno:a.warranty.invoiceno}},a.productWarranty.warranty.push(a.newWarranty.warranty),a.warranty.modelno="",a.warranty.serialno="",a.warranty.dateofpurchase="",a.warranty.invoiceno=""}}]),angular.module("prodo.ProductApp").factory("WarrantyService",["$resource",function(a){return a("/api/warranty/:prodle",{},{getProduct:{method:"GET",params:{prodle:"id"}}})}]).factory("WarrantySaveService",["$resource",function(a){return a("/api/warranty/:orgid",{},{saveProduct:{method:"POST",params:{orgid:"orge1LSosNiS"}}})}]),angular.module("prodo.UploadApp").controller("UploadController",["$scope","$log","$rootScope","fileReader",function(a,b,c,d){a.socket=io.connect("http://ec2-54-254-210-45.ap-southeast-1.compute.amazonaws.com:8000/prodoupload",{query:"session_id="+localStorage.sid}),a.fileLength,a.uploadSrc,a.progressbar=0,a.counter=0,a.getFile=function(e){a.progressbar=0,b.debug("source: "+a.uploadSrc),b.debug("getFile called ... "+e),d.readAsBinaryString(e,a).then(function(d){b.debug("reader called ... "+e),a.imageBfr=d,a.file=e;var f={filetype:a.file.type,filename:a.file.name,filebuffer:a.imageBfr};if("user"==a.uploadSrc)var g={user:{userid:c.usersession.currentUser.userid}};else if("org"==a.uploadSrc)var g={org:{userid:c.usersession.currentUser.userid,orgid:c.usersession.currentUser.org.orgid}};else if("product"==a.uploadSrc)var g={product:{userid:c.usersession.currentUser.userid,orgid:c.usersession.currentUser.org.orgid,prodle:a.product_prodle}};a.socket.emit("uploadFiles",f,g),b.debug("pic emitted")})},a.socket.removeAllListeners("productUploadResponse"),a.socket.on("productUploadResponse",function(c,d){c?b.debug("Error "+c):(b.debug("getting response for product upload  "+d),a.imageSrc=d,a.counter++,b.debug(a.counter),a.counter<a.fileLength?b.debug("emitting image "+a.counter):a.counter=0)}),a.socket.removeAllListeners("orgUploadResponse"),a.socket.on("orgUploadResponse",function(c,d){c?b.debug("Error "+c):(b.debug("getting response for org upload  "+d),a.imageSrc=d,a.counter++,b.debug(a.counter),a.counter<a.fileLength?b.debug("emitting image "+a.counter):a.counter=0)}),a.socket.removeAllListeners("userUploadResponse"),a.socket.on("userUploadResponse",function(c,d){c?b.debug("Error "+c):(b.debug("getting response for user upload  "+d),a.imageSrc=d,a.counter++,b.debug(a.counter),a.counter<a.fileLength?b.debug("emitting image "+a.counter):a.counter=0)}),a.$on("fileProgress",function(){})}]),angular.module("prodo.UploadApp").directive("ngFileSelect",["fileReader",function(){return{link:function(a,b){b.bind("change",function(b){a.file=(b.srcElement||b.target).files,a.fileLength=(b.srcElement||b.target).files,a.file=(b.srcElement||b.target).files,"user"==a.uploadSrc&&a.getFile(a.file[0]);for(var c=function(a){var b=document.createElement("label");b.type="label";var c=document.createTextNode("File "+a.name);b.appendChild(c),b.name="label",b.setAttribute("style","text-align:left");var d=document.getElementById("FileName");d.appendChild(b),d.style.width="400px";var e=document.createElement("div");e.className=" progress progress-info progress-striped active",e.id="a2"+a.name,e.style.textAlign="left",d.appendChild(e);var f=document.createElement("div");f.className="bar";var g=document.getElementById("a2"+a.name);f.style.width="300px",g.appendChild(f);var h=setInterval(function(){var a=$(".bar");400==a.width()?(clearInterval(h),$(".progress").removeClass("active")):a.width(a.width()+40)},800);b="",c="",d="",e="",f="",h="",g=""},d=0;d<=a.file.length;d++)c(a.file[d]),a.getFile(a.file[d])})}}}]),function(a){var b=function(a){var b=function(a,b,c){return function(){c.$apply(function(){b.resolve(a.result)})}},c=function(a,b,c){return function(){c.$apply(function(){b.reject(a.result)})}},d=function(a,b){return function(a){b.$broadcast("fileProgress",{total:a.total,loaded:a.loaded})}},e=function(a,e){var f=new FileReader;return f.onload=b(f,a,e),f.onerror=c(f,a,e),f.onprogress=d(f,e),f},f=function(b,c){var d=a.defer(),f=e(d,c);return f.readAsBinaryString(b),d.promise};return{readAsBinaryString:f}};a.factory("fileReader",["$q","$log",b])}(angular.module("prodo.UploadApp")),angular.module("prodo.ProdoCommentApp").directive("ngEnter",function(){return function(a,b,c){b.bind("keydown keypress",function(b){13===b.which&&(a.$apply(function(){a.$eval(c.ngEnter)}),b.preventDefault())})}}),angular.module("prodo.ProdoCommentApp").directive("commentLimit",function(){return{require:"ngModel",link:function(a,b,c,d){function e(a){if(a){if(a.length>f){var b=a.substring(0,f);return d.$setViewValue(b),d.$render(),b}return a}}var f=Number(c.commentLimit);d.$parsers.push(e)}}}),angular.module("prodo.ProdoCommentApp").directive("whenScrolled",function(){return function(a,b,c){var d=b[0];b.bind("scroll",function(){d.scrollTop+d.offsetHeight>=d.scrollHeight&&a.$apply(c.whenScrolled)})}});